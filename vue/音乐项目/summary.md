## 嘿嘿，被你找到了~
现在是不完整 summary , 部分重要的先复习记录一下，面试谈资。
## 所遇问题以及解决方案
### 推荐页面应用 better-scroll 的内容区域末尾被隐藏
#### 定位问题

首先，检查自己代码和 bs 官方 api，看看是不是自己代码写错，发现没有，根据现象观察发现只是 bs 下 内容区域的高度不正确，有部分区域被隐藏了，带着问题去官方文档查询，得出出现这问题的核心，就是 better-scroll 对 content 元素的高度计算不正确。

我是在推荐页面请求到数据时的 nextTick 中调用的 refresh 重新计算 content 区域，但是我请求到的数据中，包含了图片的 url ，而我需要用到这图片，所以在给 img 标签的 src 写上 url 数据后，浏览器在渲染过程中会再次发送 http 请求读取相应 图片 资源展示在页面上。所以这有两次 http 请求，我只在第一次的时候 refresh 让 bs 重新计算高度，这是不够的。

#### 解决方案
1. 方案一： 监听图片 load 事件，在最后一张图片加载完成后再次 refresh 重新计算内容区域高度。

2. 方案二： 给 img 标签外部套个 wrapper， 利用 wrapper 先固定高度。

### 利用 axios 库发送 ajax 请求时，发现 request url 里携带的参数编码不对
#### 定位问题
有个请求，需要携带的参数是嵌套的对象，对象里面就有 ':' 号、 ',' 号，然后利用 axios 发送请求，分析 network 时发现，request url 中 ':' 和 ',' 竟然没被 url encode。

1. 首先，检查自己代码，看看是不是代码部分写得有问题， axios 提供的一些 api 有没正确运用。

2. 看看是不是浏览器问题，自己手动 encodeURIComponent 参数后再发送请求。发现 request url 依旧没被正确编码。

3. 由于我们使用的 axios 是第三方库，我的疑心起到了 axios 身上，毕竟 axios 对我们是黑盒，所以我去看了 axios 参数编码相关的源码，最后在 ./lib/helper/buildURL.js 中定位了问题，它有个 encode 方法把 url 编码过后的参数做了一些替换，其中就有把 ':' 号、',' 号对应的 url 编码替换成了编码前的 ':' 、 ','。

#### 解决方案
通过重写 axios 的 paramsSerializer 方法可以解决问题，让其不被替换。

### 在请求歌曲 url 数据时，发现请求一次有概率会出现请求成功但没有数据的情况
#### 定位问题
因为这是概率性问题，发送一次大概 70% 概率会请求成功有数据，30% 概率会请求成功无数据，证明代码是没有问题，可能是 qq 音乐服务器在同一时间请求数量太多造成。

#### 解决方案
利用 promise 封装请求函数 request() ，经分析 network ，发现请求到的包含 songUrl 的数据有三层，每一层都有一个判断有无数据的标志位，songUrl 在第三层数据中，
所以我们在 api 请求中 return 一个 promise ，promise 中执行 request() 请求函数，请求函数中先利用 axios 发送请求，得到数据后判断数据第一次标志位有无数据，无的话 retry 重新执行 request() 函数，若第一层有数据则拿第二层中标志位判断，若标志位有数据则接着判断第三层标志位有无数据，若有则拿到数据 songUrl，然后 resolve 出去，若标志都无数据的话，则重新执行 request() 函数发送数据。同时在 retry() 函数中定义最多请求 3 次，若超过 3 次 则 reject 出去。



